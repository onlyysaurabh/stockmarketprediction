2025-04-24 20:21:07,789 - INFO - Prepared 1 training jobs with 4 max workers
2025-04-24 20:21:07,791 - INFO - Starting job: model=xgboost, symbol=AAPL
2025-04-24 20:21:25,933 - INFO - Job stdout: model=xgboost, symbol=AAPL
Training with date range: 2024-10-25 to 2025-04-25
Training XGBoost model for 1 stock(s): AAPL
Using look_back=20, num_features=15
Hyperparameter tuning with: n_estimators=100,200,300, max_depth=3,4,5, learning_rate=0.01,0.1,0.2

--- Processing Stock: AAPL ---
Best parameters: {'colsample_bytree': 1.0, 'learning_rate': 0.2, 'max_depth': 4, 'n_estimators': 200, 'subsample': 1.0}

Regression Metrics:
  Mean Squared Error (MSE): 520.5738
  Root Mean Squared Error (RMSE): 22.8161
  Mean Absolute Error (MAE): 20.5341
  MAPE: 10.65%
  R-squared (R2): -1.8670

Classification Metrics:
  Accuracy: 0.5625
  Confusion Matrix:
 [[5 3]
 [4 4]]
  Classification Report:
               precision    recall  f1-score   support

           0       0.56      0.62      0.59         8
           1       0.57      0.50      0.53         8

    accuracy                           0.56        16
   macro avg       0.56      0.56      0.56        16
weighted avg       0.56      0.56      0.56        16


XGBoost Feature Importance (Top 10):
  Close: 0.7015
  Low: 0.1597
  High: 0.0294
  Close_Lag_9: 0.0188
  Close_Lag_1: 0.0179
  Close_Lag_3: 0.0167
  Close_Lag_2: 0.0139
  SMA: 0.0094
  Close_Lag_5: 0.0085
  EMA: 0.0076
Evaluation results for AAPL stored in MongoDB.
Trained XGBoost model saved to: /home/skylap/Downloads/stockmarketprediction/train-model/AAPL/xgboost-20250424-202124/model.pkl
Close scaler saved to: /home/skylap/Downloads/stockmarketprediction/train-model/AAPL/xgboost-20250424-202124/close_scaler.pkl
Other features scaler saved to: /home/skylap/Downloads/stockmarketprediction/train-model/AAPL/xgboost-20250424-202124/other_scaler.pkl
Target scaler saved to: /home/skylap/Downloads/stockmarketprediction/train-model/AAPL/xgboost-20250424-202124/target_scaler.pkl
Selected features saved to: /home/skylap/Downloads/stockmarketprediction/train-model/AAPL/xgboost-20250424-202124/selected_features.pkl

--- XGBoost Stock Price Prediction and Evaluation Completed. ---
2025-04-24 20:21:25,934 - WARNING - Job stderr: model=xgboost, symbol=AAPL
/home/skylap/Downloads/stockmarketprediction/train-model/train-xgboost.py:190: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise in a future error of pandas. Value '[ 2.9293157  -0.61803595 -1.20431626 -1.0711731  -0.56825364 -0.79438809
 -0.66387959 -0.1229772  -0.63848446 -0.47875858 -0.6181291  -0.72548125
  0.07562646 -0.32623142 -0.66538986 -0.65219331  0.40988817  0.30108229
  1.28515539  0.15598339  0.02652276 -0.15766681  1.17847187  0.54123829
 -0.46410498 -0.1257183   1.38510923  0.45327346 -0.47803671 -0.65923568
 -0.9817479  -0.65634488 -0.87561992 -0.19025069 -0.47218192 -0.19372031
 -0.61679181 -0.35311686 -0.9059384  -0.90218934 -0.20758218 -0.26982255
 -0.38003557 -0.49911726 -0.60822918 -0.08662763 -0.40762293 -0.1875994
 -0.40617254 -0.474607   -0.43790814  0.42027043  0.55553595  0.10345665
  0.06422958  0.02229135 -0.3780363  -0.56568884 -0.16806238 -0.35177292
  1.15400153 -0.50357821 -0.82977961 -0.83069442 -0.74324853 -0.65263907
  0.19499756 -0.76593916 -0.78279828  1.46308101  2.21129272  3.36080677
  2.04325371  4.15684477  2.07720149  0.93138992  1.39435048 -0.2692404
  0.00981001 -0.26955975 -0.42230979 -0.22545259]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  X.loc[:, other_features] = other_scaler.fit_transform(X[other_features].astype(np.float64))
2025-04-24 20:21:25,934 - INFO - Job completed: model=xgboost, symbol=AAPL
2025-04-24 20:21:25,934 - INFO - Training Summary:
2025-04-24 20:21:25,934 - INFO -   Total jobs: 1
2025-04-24 20:21:25,934 - INFO -   Successful: 1
2025-04-24 20:21:25,934 - INFO -   Failed: 0
2025-04-24 20:21:25,934 - INFO -   Total duration: 18.14 seconds
2025-04-24 20:23:09,103 - INFO - Prepared 1 training jobs with 4 max workers
2025-04-24 20:23:09,108 - INFO - Starting job: model=arima, symbol=AAPL
2025-04-24 20:25:16,770 - INFO - Prepared 1 training jobs with 4 max workers
2025-04-24 20:25:16,773 - INFO - Starting job: model=arima, symbol=AAPL
2025-04-24 20:25:46,980 - INFO - Job stdout: model=arima, symbol=AAPL
ARIMA parameters: price_field='Close', feature_engineering=True
max_p=5, max_q=5, test_size=0.2
Differencing order (d): 1 (fixed)
Training with date range: 2022-04-24 to 2025-04-24
Training ARIMA model for 1 stock(s): AAPL
Connected to MongoDB: mongodb://localhost:27017/, Database: 'stock_data'

--- Processing Stock: AAPL ---
Loaded 738 data points for AAPL.
Applied fixed differencing d=1.
Train set size: 589, Test set size: 148
Searching for best ARIMA(p,1,q) order (max_p=5, max_q=5)...
Auto search complete. Best Order: ARIMA(3, 1, 4) with AIC=2869.63
Training ARIMA(3, 1, 4) model...
ARIMA model training finished.
                               SARIMAX Results                                
==============================================================================
Dep. Variable:                  Close   No. Observations:                  589
Model:                 ARIMA(3, 1, 4)   Log Likelihood               -1426.814
Date:                Thu, 24 Apr 2025   AIC                           2869.628
Time:                        20:23:47   BIC                           2904.642
Sample:                             0   HQIC                          2883.270
                                - 589                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
ar.L1         -1.6369      0.087    -18.763      0.000      -1.808      -1.466
ar.L2         -1.6476      0.067    -24.631      0.000      -1.779      -1.516
ar.L3         -0.8999      0.088    -10.215      0.000      -1.073      -0.727
ma.L1          0.6418      0.278      2.312      0.021       0.098       1.186
ma.L2          0.0110      0.437      0.025      0.980      -0.845       0.867
ma.L3         -0.7186      0.441     -1.630      0.103      -1.583       0.146
ma.L4         -0.9336      0.254     -3.673      0.000      -1.432      -0.435
sigma2         7.4509      2.020      3.689      0.000       3.492      11.409
===================================================================================
Ljung-Box (L1) (Q):                   1.05   Jarque-Bera (JB):               130.22
Prob(Q):                              0.31   Prob(JB):                         0.00
Heteroskedasticity (H):               0.83   Skew:                             0.10
Prob(H) (two-sided):                  0.19   Kurtosis:                         5.30
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
Starting Walk-Forward Validation...
Inverse transforming predictions...
Calculating evaluation metrics...

Model Evaluation (Original Scale - Regression Metrics):
  RMSE: 4.7443
  MAE:  3.1763
  MAPE: 1.44%

Model Evaluation (Direction Prediction - Classification Metrics):
  Confusion Matrix (Rows: Actual, Cols: Predicted):
[[30 39]
 [31 47]]
  Accuracy:    0.5238
  Sensitivity: 0.6026 (Recall/TPR)
  Specificity: 0.4348 (TNR)
  Precision:   0.5465
  F1-Score:    0.5732

Analyzing ARIMA components...
Error extracting ARIMA component info: 'numpy.ndarray' object has no attribute 'index'

Trained ARIMA model saved to: /home/skylap/Downloads/stockmarketprediction/train-model/AAPL/arima-20250424-202546/model.pkl
Evaluation results for AAPL stored in MongoDB collection 'arima_evaluation_results'.

MongoDB connection closed.

--- ARIMA Stock Price Prediction and Evaluation Completed for all symbols. ---
2025-04-24 20:25:46,980 - WARNING - Job stderr: model=arima, symbol=AAPL
AIC Search:   0%|          | 0/36 [00:00<?, ?it/s]
AIC Search:   6%|▌         | 2/36 [00:00<00:06,  4.88it/s]
AIC Search:   8%|▊         | 3/36 [00:00<00:11,  2.87it/s]
AIC Search:  11%|█         | 4/36 [00:01<00:16,  1.90it/s]
AIC Search:  14%|█▍        | 5/36 [00:02<00:22,  1.38it/s]
AIC Search:  17%|█▋        | 6/36 [00:03<00:24,  1.24it/s]
AIC Search:  22%|██▏       | 8/36 [00:04<00:14,  1.91it/s]
AIC Search:  25%|██▌       | 9/36 [00:04<00:13,  2.05it/s]
AIC Search:  28%|██▊       | 10/36 [00:05<00:14,  1.79it/s]
AIC Search:  31%|███       | 11/36 [00:05<00:12,  1.92it/s]
AIC Search:  33%|███▎      | 12/36 [00:06<00:13,  1.74it/s]
AIC Search:  39%|███▉      | 14/36 [00:07<00:09,  2.27it/s]
AIC Search:  42%|████▏     | 15/36 [00:07<00:10,  2.10it/s]
AIC Search:  44%|████▍     | 16/36 [00:08<00:12,  1.56it/s]
AIC Search:  47%|████▋     | 17/36 [00:09<00:12,  1.49it/s]
AIC Search:  50%|█████     | 18/36 [00:11<00:17,  1.03it/s]
AIC Search:  56%|█████▌    | 20/36 [00:12<00:11,  1.42it/s]
AIC Search:  58%|█████▊    | 21/36 [00:13<00:11,  1.25it/s]
AIC Search:  61%|██████    | 22/36 [00:14<00:13,  1.05it/s]
AIC Search:  64%|██████▍   | 23/36 [00:16<00:16,  1.23s/it]
AIC Search:  67%|██████▋   | 24/36 [00:18<00:17,  1.49s/it]
AIC Search:  72%|███████▏  | 26/36 [00:19<00:10,  1.02s/it]
AIC Search:  75%|███████▌  | 27/36 [00:21<00:10,  1.18s/it]
AIC Search:  78%|███████▊  | 28/36 [00:22<00:10,  1.26s/it]
AIC Search:  81%|████████  | 29/36 [00:24<00:10,  1.51s/it]
AIC Search:  83%|████████▎ | 30/36 [00:27<00:10,  1.77s/it]
AIC Search:  89%|████████▉ | 32/36 [00:28<00:04,  1.25s/it]
AIC Search:  92%|█████████▏| 33/36 [00:29<00:03,  1.12s/it]
AIC Search:  94%|█████████▍| 34/36 [00:30<00:02,  1.26s/it]
AIC Search:  97%|█████████▋| 35/36 [00:32<00:01,  1.45s/it]
AIC Search: 100%|██████████| 36/36 [00:35<00:00,  1.69s/it]
AIC Search: 100%|██████████| 36/36 [00:35<00:00,  1.02it/s]

Walk-Forward Validation:   0%|          | 0/148 [00:00<?, ?it/s]
Walk-Forward Validation:   1%|          | 1/148 [00:01<03:31,  1.44s/it]
Walk-Forward Validation:   1%|▏         | 2/148 [00:02<02:18,  1.06it/s]
Walk-Forward Validation:   2%|▏         | 3/148 [00:02<01:55,  1.26it/s]
Walk-Forward Validation:   3%|▎         | 4/148 [00:03<01:32,  1.56it/s]
Walk-Forward Validation:   3%|▎         | 5/148 [00:04<02:13,  1.07it/s]
Walk-Forward Validation:   4%|▍         | 6/148 [00:05<02:22,  1.00s/it]
Walk-Forward Validation:   5%|▍         | 7/148 [00:06<01:56,  1.21it/s]
Walk-Forward Validation:   5%|▌         | 8/148 [00:06<01:41,  1.37it/s]
Walk-Forward Validation:   6%|▌         | 9/148 [00:08<02:19,  1.00s/it]
Walk-Forward Validation:   7%|▋         | 10/148 [00:09<02:31,  1.10s/it]
Walk-Forward Validation:   7%|▋         | 11/148 [00:09<01:54,  1.20it/s]
Walk-Forward Validation:   8%|▊         | 12/148 [00:09<01:26,  1.57it/s]
Walk-Forward Validation:   9%|▉         | 13/148 [00:10<01:15,  1.78it/s]
Walk-Forward Validation:   9%|▉         | 14/148 [00:11<01:21,  1.65it/s]
Walk-Forward Validation:  10%|█         | 15/148 [00:11<01:28,  1.50it/s]
Walk-Forward Validation:  11%|█         | 16/148 [00:12<01:34,  1.39it/s]
Walk-Forward Validation:  11%|█▏        | 17/148 [00:12<01:14,  1.76it/s]
Walk-Forward Validation:  12%|█▏        | 18/148 [00:13<01:08,  1.90it/s]
Walk-Forward Validation:  13%|█▎        | 19/148 [00:14<01:27,  1.47it/s]
Walk-Forward Validation:  14%|█▎        | 20/148 [00:14<01:10,  1.82it/s]
Walk-Forward Validation:  14%|█▍        | 21/148 [00:15<01:26,  1.47it/s]
Walk-Forward Validation:  15%|█▍        | 22/148 [00:16<01:18,  1.61it/s]
Walk-Forward Validation:  16%|█▌        | 23/148 [00:16<01:03,  1.96it/s]
Walk-Forward Validation:  16%|█▌        | 24/148 [00:16<00:54,  2.28it/s]
Walk-Forward Validation:  17%|█▋        | 25/148 [00:16<00:42,  2.88it/s]
Walk-Forward Validation:  18%|█▊        | 26/148 [00:17<00:52,  2.32it/s]
Walk-Forward Validation:  18%|█▊        | 27/148 [00:18<01:11,  1.69it/s]
Walk-Forward Validation:  19%|█▉        | 28/148 [00:18<01:01,  1.94it/s]
Walk-Forward Validation:  20%|█▉        | 29/148 [00:19<01:05,  1.83it/s]
Walk-Forward Validation:  20%|██        | 30/148 [00:20<01:21,  1.46it/s]
Walk-Forward Validation:  21%|██        | 31/148 [00:21<01:28,  1.32it/s]
Walk-Forward Validation:  22%|██▏       | 32/148 [00:21<01:19,  1.46it/s]
Walk-Forward Validation:  22%|██▏       | 33/148 [00:21<00:59,  1.92it/s]
Walk-Forward Validation:  23%|██▎       | 34/148 [00:22<00:52,  2.15it/s]
Walk-Forward Validation:  24%|██▎       | 35/148 [00:22<00:42,  2.67it/s]
Walk-Forward Validation:  24%|██▍       | 36/148 [00:22<00:48,  2.29it/s]
Walk-Forward Validation:  25%|██▌       | 37/148 [00:23<00:40,  2.71it/s]
Walk-Forward Validation:  26%|██▌       | 38/148 [00:23<00:32,  3.39it/s]
Walk-Forward Validation:  26%|██▋       | 39/148 [00:23<00:31,  3.48it/s]
Walk-Forward Validation:  27%|██▋       | 40/148 [00:23<00:32,  3.28it/s]
Walk-Forward Validation:  28%|██▊       | 41/148 [00:24<00:43,  2.45it/s]
Walk-Forward Validation:  28%|██▊       | 42/148 [00:25<00:45,  2.35it/s]
Walk-Forward Validation:  29%|██▉       | 43/148 [00:25<00:36,  2.84it/s]
Walk-Forward Validation:  30%|██▉       | 44/148 [00:25<00:29,  3.51it/s]
Walk-Forward Validation:  30%|███       | 45/148 [00:26<00:47,  2.18it/s]
Walk-Forward Validation:  31%|███       | 46/148 [00:26<00:36,  2.78it/s]
Walk-Forward Validation:  32%|███▏      | 47/148 [00:26<00:35,  2.83it/s]
Walk-Forward Validation:  32%|███▏      | 48/148 [00:27<00:35,  2.84it/s]
Walk-Forward Validation:  33%|███▎      | 49/148 [00:27<00:28,  3.42it/s]
Walk-Forward Validation:  34%|███▍      | 50/148 [00:27<00:25,  3.88it/s]
Walk-Forward Validation:  35%|███▌      | 52/148 [00:27<00:23,  4.02it/s]
Walk-Forward Validation:  36%|███▌      | 53/148 [00:28<00:22,  4.30it/s]
Walk-Forward Validation:  36%|███▋      | 54/148 [00:28<00:24,  3.78it/s]
Walk-Forward Validation:  37%|███▋      | 55/148 [00:28<00:27,  3.40it/s]
Walk-Forward Validation:  38%|███▊      | 56/148 [00:29<00:27,  3.40it/s]
Walk-Forward Validation:  39%|███▊      | 57/148 [00:29<00:22,  3.98it/s]
Walk-Forward Validation:  39%|███▉      | 58/148 [00:29<00:36,  2.45it/s]
Walk-Forward Validation:  40%|███▉      | 59/148 [00:30<00:30,  2.95it/s]
Walk-Forward Validation:  41%|████      | 60/148 [00:30<00:30,  2.91it/s]
Walk-Forward Validation:  41%|████      | 61/148 [00:30<00:32,  2.71it/s]
Walk-Forward Validation:  42%|████▏     | 62/148 [00:31<00:27,  3.13it/s]
Walk-Forward Validation:  43%|████▎     | 63/148 [00:31<00:24,  3.48it/s]
Walk-Forward Validation:  43%|████▎     | 64/148 [00:31<00:31,  2.63it/s]
Walk-Forward Validation:  44%|████▍     | 65/148 [00:32<00:34,  2.41it/s]
Walk-Forward Validation:  45%|████▍     | 66/148 [00:32<00:36,  2.23it/s]
Walk-Forward Validation:  45%|████▌     | 67/148 [00:33<00:35,  2.26it/s]
Walk-Forward Validation:  46%|████▌     | 68/148 [00:33<00:31,  2.50it/s]
Walk-Forward Validation:  47%|████▋     | 69/148 [00:34<00:32,  2.44it/s]
Walk-Forward Validation:  47%|████▋     | 70/148 [00:34<00:25,  3.11it/s]
Walk-Forward Validation:  48%|████▊     | 71/148 [00:34<00:22,  3.45it/s]
Walk-Forward Validation:  49%|████▊     | 72/148 [00:34<00:19,  3.89it/s]
Walk-Forward Validation:  49%|████▉     | 73/148 [00:36<00:48,  1.55it/s]
Walk-Forward Validation:  50%|█████     | 74/148 [00:36<00:45,  1.63it/s]
Walk-Forward Validation:  51%|█████     | 75/148 [00:37<00:52,  1.40it/s]
Walk-Forward Validation:  51%|█████▏    | 76/148 [00:38<01:02,  1.16it/s]
Walk-Forward Validation:  52%|█████▏    | 77/148 [00:39<01:02,  1.14it/s]
Walk-Forward Validation:  53%|█████▎    | 78/148 [00:40<00:54,  1.28it/s]
Walk-Forward Validation:  53%|█████▎    | 79/148 [00:40<00:46,  1.48it/s]
Walk-Forward Validation:  54%|█████▍    | 80/148 [00:42<01:01,  1.11it/s]
Walk-Forward Validation:  55%|█████▍    | 81/148 [00:42<00:46,  1.43it/s]
Walk-Forward Validation:  55%|█████▌    | 82/148 [00:42<00:36,  1.83it/s]
Walk-Forward Validation:  56%|█████▌    | 83/148 [00:43<00:39,  1.66it/s]
Walk-Forward Validation:  57%|█████▋    | 84/148 [00:44<00:51,  1.25it/s]
Walk-Forward Validation:  57%|█████▋    | 85/148 [00:45<00:50,  1.24it/s]
Walk-Forward Validation:  58%|█████▊    | 86/148 [00:46<00:52,  1.19it/s]
Walk-Forward Validation:  59%|█████▉    | 87/148 [00:46<00:38,  1.59it/s]
Walk-Forward Validation:  59%|█████▉    | 88/148 [00:47<00:39,  1.52it/s]
Walk-Forward Validation:  60%|██████    | 89/148 [00:48<00:47,  1.24it/s]
Walk-Forward Validation:  61%|██████    | 90/148 [00:50<01:05,  1.13s/it]
Walk-Forward Validation:  61%|██████▏   | 91/148 [00:50<00:51,  1.10it/s]
Walk-Forward Validation:  62%|██████▏   | 92/148 [00:51<00:47,  1.17it/s]
Walk-Forward Validation:  63%|██████▎   | 93/148 [00:51<00:36,  1.52it/s]
Walk-Forward Validation:  64%|██████▎   | 94/148 [00:52<00:41,  1.30it/s]
Walk-Forward Validation:  64%|██████▍   | 95/148 [00:53<00:46,  1.14it/s]
Walk-Forward Validation:  65%|██████▍   | 96/148 [00:53<00:33,  1.54it/s]
Walk-Forward Validation:  66%|██████▌   | 97/148 [00:54<00:29,  1.72it/s]
Walk-Forward Validation:  66%|██████▌   | 98/148 [00:56<00:58,  1.16s/it]
Walk-Forward Validation:  67%|██████▋   | 99/148 [00:57<00:48,  1.01it/s]
Walk-Forward Validation:  68%|██████▊   | 100/148 [00:58<00:47,  1.00it/s]
Walk-Forward Validation:  68%|██████▊   | 101/148 [00:58<00:37,  1.25it/s]
Walk-Forward Validation:  69%|██████▉   | 102/148 [00:59<00:30,  1.51it/s]
Walk-Forward Validation:  70%|██████▉   | 103/148 [00:59<00:28,  1.58it/s]
Walk-Forward Validation:  70%|███████   | 104/148 [00:59<00:22,  1.93it/s]
Walk-Forward Validation:  71%|███████   | 105/148 [01:00<00:23,  1.86it/s]
Walk-Forward Validation:  72%|███████▏  | 106/148 [01:00<00:19,  2.13it/s]
Walk-Forward Validation:  72%|███████▏  | 107/148 [01:01<00:19,  2.13it/s]
Walk-Forward Validation:  73%|███████▎  | 108/148 [01:01<00:20,  2.00it/s]
Walk-Forward Validation:  74%|███████▎  | 109/148 [01:02<00:15,  2.45it/s]
Walk-Forward Validation:  74%|███████▍  | 110/148 [01:02<00:18,  2.03it/s]
Walk-Forward Validation:  75%|███████▌  | 111/148 [01:03<00:16,  2.23it/s]
Walk-Forward Validation:  76%|███████▌  | 112/148 [01:03<00:17,  2.00it/s]
Walk-Forward Validation:  76%|███████▋  | 113/148 [01:03<00:15,  2.32it/s]
Walk-Forward Validation:  77%|███████▋  | 114/148 [01:04<00:12,  2.67it/s]
Walk-Forward Validation:  78%|███████▊  | 115/148 [01:05<00:16,  1.98it/s]
Walk-Forward Validation:  78%|███████▊  | 116/148 [01:05<00:16,  1.93it/s]
Walk-Forward Validation:  79%|███████▉  | 117/148 [01:06<00:17,  1.82it/s]
Walk-Forward Validation:  80%|███████▉  | 118/148 [01:08<00:28,  1.07it/s]
Walk-Forward Validation:  80%|████████  | 119/148 [01:09<00:30,  1.04s/it]
Walk-Forward Validation:  81%|████████  | 120/148 [01:09<00:22,  1.24it/s]
Walk-Forward Validation:  82%|████████▏ | 121/148 [01:11<00:33,  1.23s/it]
Walk-Forward Validation:  82%|████████▏ | 122/148 [01:12<00:24,  1.04it/s]
Walk-Forward Validation:  83%|████████▎ | 123/148 [01:12<00:19,  1.27it/s]
Walk-Forward Validation:  84%|████████▍ | 124/148 [01:12<00:15,  1.55it/s]
Walk-Forward Validation:  84%|████████▍ | 125/148 [01:13<00:12,  1.80it/s]
Walk-Forward Validation:  85%|████████▌ | 126/148 [01:14<00:14,  1.55it/s]
Walk-Forward Validation:  86%|████████▌ | 127/148 [01:14<00:11,  1.79it/s]
Walk-Forward Validation:  86%|████████▋ | 128/148 [01:15<00:11,  1.68it/s]
Walk-Forward Validation:  87%|████████▋ | 129/148 [01:15<00:10,  1.88it/s]
Walk-Forward Validation:  88%|████████▊ | 130/148 [01:15<00:08,  2.15it/s]
Walk-Forward Validation:  89%|████████▊ | 131/148 [01:16<00:07,  2.32it/s]
Walk-Forward Validation:  89%|████████▉ | 132/148 [01:17<00:11,  1.44it/s]
Walk-Forward Validation:  90%|████████▉ | 133/148 [01:18<00:13,  1.12it/s]
Walk-Forward Validation:  91%|█████████ | 134/148 [01:18<00:09,  1.52it/s]
Walk-Forward Validation:  91%|█████████ | 135/148 [01:19<00:06,  1.88it/s]
Walk-Forward Validation:  92%|█████████▏| 136/148 [01:21<00:12,  1.05s/it]
Walk-Forward Validation:  93%|█████████▎| 137/148 [01:22<00:12,  1.18s/it]
Walk-Forward Validation:  93%|█████████▎| 138/148 [01:23<00:11,  1.15s/it]
Walk-Forward Validation:  94%|█████████▍| 139/148 [01:25<00:11,  1.26s/it]
Walk-Forward Validation:  95%|█████████▍| 140/148 [01:27<00:11,  1.46s/it]
Walk-Forward Validation:  95%|█████████▌| 141/148 [01:31<00:15,  2.25s/it]
Walk-Forward Validation:  96%|█████████▌| 142/148 [01:35<00:17,  2.88s/it]
Walk-Forward Validation:  97%|█████████▋| 143/148 [01:40<00:17,  3.53s/it]
Walk-Forward Validation:  97%|█████████▋| 144/148 [01:42<00:11,  2.82s/it]
Walk-Forward Validation:  98%|█████████▊| 145/148 [01:47<00:11,  3.68s/it]
Walk-Forward Validation:  99%|█████████▊| 146/148 [01:49<00:05,  2.96s/it]
Walk-Forward Validation:  99%|█████████▉| 147/148 [01:53<00:03,  3.28s/it]
Walk-Forward Validation: 100%|██████████| 148/148 [01:58<00:00,  3.90s/it]
Walk-Forward Validation: 100%|██████████| 148/148 [01:58<00:00,  1.25it/s]
2025-04-24 20:25:46,981 - INFO - Job completed: model=arima, symbol=AAPL
2025-04-24 20:25:46,986 - INFO - Training Summary:
2025-04-24 20:25:46,986 - INFO -   Total jobs: 1
2025-04-24 20:25:46,986 - INFO -   Successful: 1
2025-04-24 20:25:46,986 - INFO -   Failed: 0
2025-04-24 20:25:46,986 - INFO -   Total duration: 157.88 seconds
2025-04-24 20:25:55,870 - INFO - Job stdout: model=arima, symbol=AAPL
ARIMA parameters: price_field='Close', feature_engineering=True
max_p=5, max_q=5, test_size=0.2
Differencing order (d): 1 (fixed)
Training with date range: 2024-10-24 to 2025-04-24
Training ARIMA model for 1 stock(s): AAPL
Connected to MongoDB: mongodb://localhost:27017/, Database: 'stock_data'

--- Processing Stock: AAPL ---
Loaded 109 data points for AAPL.
Applied fixed differencing d=1.
Train set size: 86, Test set size: 22
Searching for best ARIMA(p,1,q) order (max_p=5, max_q=5)...
Auto search complete. Best Order: ARIMA(0, 1, 1) with AIC=472.64
Training ARIMA(0, 1, 1) model...
ARIMA model training finished.
                               SARIMAX Results                                
==============================================================================
Dep. Variable:                  Close   No. Observations:                   86
Model:                 ARIMA(0, 1, 1)   Log Likelihood                -234.318
Date:                Thu, 24 Apr 2025   AIC                            472.636
Time:                        20:25:54   BIC                            477.521
Sample:                             0   HQIC                           474.601
                                 - 86                                         
Covariance Type:                  opg                                         
==============================================================================
                 coef    std err          z      P>|z|      [0.025      0.975]
------------------------------------------------------------------------------
ma.L1         -0.9556      0.038    -25.101      0.000      -1.030      -0.881
sigma2        14.1080      1.883      7.493      0.000      10.418      17.798
===================================================================================
Ljung-Box (L1) (Q):                   0.17   Jarque-Bera (JB):                 3.63
Prob(Q):                              0.68   Prob(JB):                         0.16
Heteroskedasticity (H):               3.69   Skew:                            -0.45
Prob(H) (two-sided):                  0.00   Kurtosis:                         3.48
===================================================================================

Warnings:
[1] Covariance matrix calculated using the outer product of gradients (complex-step).
Starting Walk-Forward Validation...
Inverse transforming predictions...
Calculating evaluation metrics...

Model Evaluation (Original Scale - Regression Metrics):
  RMSE: 8.6164
  MAE:  5.9182
  MAPE: 2.94%

Model Evaluation (Direction Prediction - Classification Metrics):
  Confusion Matrix (Rows: Actual, Cols: Predicted):
[[5 5]
 [6 5]]
  Accuracy:    0.4762
  Sensitivity: 0.4545 (Recall/TPR)
  Specificity: 0.5000 (TNR)
  Precision:   0.5000
  F1-Score:    0.4762

Analyzing ARIMA components...
Error extracting ARIMA component info: 'numpy.ndarray' object has no attribute 'index'

Trained ARIMA model saved to: /home/skylap/Downloads/stockmarketprediction/train-model/AAPL/arima-20250424-202555/model.pkl
Evaluation results for AAPL stored in MongoDB collection 'arima_evaluation_results'.

MongoDB connection closed.

--- ARIMA Stock Price Prediction and Evaluation Completed for all symbols. ---
2025-04-24 20:25:55,871 - WARNING - Job stderr: model=arima, symbol=AAPL
AIC Search:   0%|          | 0/36 [00:00<?, ?it/s]
AIC Search:   6%|▌         | 2/36 [00:00<00:02, 13.17it/s]
AIC Search:  11%|█         | 4/36 [00:01<00:17,  1.80it/s]
AIC Search:  14%|█▍        | 5/36 [00:06<00:50,  1.63s/it]
AIC Search:  17%|█▋        | 6/36 [00:10<01:10,  2.36s/it]
AIC Search:  22%|██▏       | 8/36 [00:10<00:38,  1.37s/it]
AIC Search:  25%|██▌       | 9/36 [00:11<00:32,  1.20s/it]
AIC Search:  28%|██▊       | 10/36 [00:12<00:28,  1.11s/it]
AIC Search:  31%|███       | 11/36 [00:14<00:37,  1.49s/it]
AIC Search:  33%|███▎      | 12/36 [00:18<00:52,  2.17s/it]
AIC Search:  39%|███▉      | 14/36 [00:18<00:28,  1.29s/it]
AIC Search:  42%|████▏     | 15/36 [00:19<00:23,  1.10s/it]
AIC Search:  44%|████▍     | 16/36 [00:21<00:26,  1.32s/it]
AIC Search:  47%|████▋     | 17/36 [00:26<00:42,  2.24s/it]
AIC Search:  50%|█████     | 18/36 [00:27<00:34,  1.94s/it]
AIC Search:  56%|█████▌    | 20/36 [00:27<00:18,  1.16s/it]
AIC Search:  58%|█████▊    | 21/36 [00:27<00:13,  1.08it/s]
AIC Search:  61%|██████    | 22/36 [00:28<00:11,  1.24it/s]
AIC Search:  64%|██████▍   | 23/36 [00:28<00:09,  1.31it/s]
AIC Search:  67%|██████▋   | 24/36 [00:29<00:08,  1.47it/s]
AIC Search:  72%|███████▏  | 26/36 [00:29<00:04,  2.33it/s]
AIC Search:  75%|███████▌  | 27/36 [00:30<00:03,  2.41it/s]
AIC Search:  78%|███████▊  | 28/36 [00:30<00:03,  2.40it/s]
AIC Search:  81%|████████  | 29/36 [00:31<00:03,  2.15it/s]
AIC Search:  83%|████████▎ | 30/36 [00:31<00:03,  1.92it/s]
AIC Search:  89%|████████▉ | 32/36 [00:32<00:01,  2.55it/s]
AIC Search:  92%|█████████▏| 33/36 [00:32<00:01,  2.61it/s]
AIC Search:  94%|█████████▍| 34/36 [00:33<00:00,  2.23it/s]
AIC Search:  97%|█████████▋| 35/36 [00:33<00:00,  1.98it/s]
AIC Search: 100%|██████████| 36/36 [00:34<00:00,  1.56it/s]
AIC Search: 100%|██████████| 36/36 [00:34<00:00,  1.03it/s]

Walk-Forward Validation:   0%|          | 0/22 [00:00<?, ?it/s]
Walk-Forward Validation:  23%|██▎       | 5/22 [00:00<00:00, 38.99it/s]
Walk-Forward Validation:  41%|████      | 9/22 [00:00<00:00, 33.58it/s]
Walk-Forward Validation:  59%|█████▉    | 13/22 [00:00<00:00, 30.07it/s]
Walk-Forward Validation:  77%|███████▋  | 17/22 [00:00<00:00, 28.02it/s]
Walk-Forward Validation:  91%|█████████ | 20/22 [00:00<00:00, 20.99it/s]
Walk-Forward Validation: 100%|██████████| 22/22 [00:00<00:00, 22.93it/s]
2025-04-24 20:25:55,871 - INFO - Job completed: model=arima, symbol=AAPL
2025-04-24 20:25:55,871 - INFO - Training Summary:
2025-04-24 20:25:55,871 - INFO -   Total jobs: 1
2025-04-24 20:25:55,871 - INFO -   Successful: 1
2025-04-24 20:25:55,871 - INFO -   Failed: 0
2025-04-24 20:25:55,872 - INFO -   Total duration: 39.10 seconds
2025-04-24 20:27:23,283 - INFO - Prepared 1 training jobs with 4 max workers
2025-04-24 20:27:23,286 - INFO - Starting job: model=xgboost, symbol=MSFT
2025-04-24 20:27:41,331 - INFO - Job stdout: model=xgboost, symbol=MSFT
Training with date range: 2024-10-24 to 2025-04-24
Training XGBoost model for 1 stock(s): MSFT
Using look_back=20, num_features=15
Hyperparameter tuning with: n_estimators=100,200,300, max_depth=3,4,5, learning_rate=0.01,0.1,0.2

--- Processing Stock: MSFT ---
Best parameters: {'colsample_bytree': 0.9, 'learning_rate': 0.2, 'max_depth': 4, 'n_estimators': 100, 'subsample': 0.8}

Regression Metrics:
  Mean Squared Error (MSE): 168.7692
  Root Mean Squared Error (RMSE): 12.9911
  Mean Absolute Error (MAE): 9.7327
  MAPE: 2.63%
  R-squared (R2): -0.0612

Classification Metrics:
  Accuracy: 0.4000
  Confusion Matrix:
 [[4 5]
 [4 2]]
  Classification Report:
               precision    recall  f1-score   support

           0       0.50      0.44      0.47         9
           1       0.29      0.33      0.31         6

    accuracy                           0.40        15
   macro avg       0.39      0.39      0.39        15
weighted avg       0.41      0.40      0.41        15


XGBoost Feature Importance (Top 10):
  SMA: 0.3863
  Low: 0.2053
  Close: 0.2041
  EMA: 0.0592
  Close_Lag_1: 0.0400
  Open: 0.0271
  High: 0.0152
  Close_Lag_6: 0.0151
  Close_Lag_14: 0.0131
  Close_Lag_7: 0.0080
Evaluation results for MSFT stored in MongoDB.
Trained XGBoost model saved to: /home/skylap/Downloads/stockmarketprediction/train-model/MSFT/xgboost-20250424-202739/model.pkl
Close scaler saved to: /home/skylap/Downloads/stockmarketprediction/train-model/MSFT/xgboost-20250424-202739/close_scaler.pkl
Other features scaler saved to: /home/skylap/Downloads/stockmarketprediction/train-model/MSFT/xgboost-20250424-202739/other_scaler.pkl
Target scaler saved to: /home/skylap/Downloads/stockmarketprediction/train-model/MSFT/xgboost-20250424-202739/target_scaler.pkl
Selected features saved to: /home/skylap/Downloads/stockmarketprediction/train-model/MSFT/xgboost-20250424-202739/selected_features.pkl

--- XGBoost Stock Price Prediction and Evaluation Completed. ---
2025-04-24 20:27:41,331 - WARNING - Job stderr: model=xgboost, symbol=MSFT
/home/skylap/Downloads/stockmarketprediction/train-model/train-xgboost.py:190: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise in a future error of pandas. Value '[-1.25903973e-01  3.92619868e+00 -4.99835538e-01 -1.67602456e+00
 -1.57499671e+00 -6.01363766e-01 -1.08791043e+00 -1.07929603e+00
 -7.21180419e-01 -7.44099818e-01 -3.60405923e-01 -5.99264129e-01
 -9.01896348e-01 -3.96953338e-01 -6.51686367e-01 -7.17314732e-01
 -4.52220879e-01 -8.77819205e-01  1.91376646e-01  1.80407516e-01
  3.48976949e-01 -5.74716040e-01 -8.53339796e-01  1.11858211e+00
 -7.40998516e-02 -6.52990378e-02  2.97671156e+00  9.78828721e-01
  1.40514418e-01 -3.64477648e-01 -7.78066838e-01 -7.78743824e-01
 -1.33448929e-01 -3.36436706e-01 -5.99116958e-01 -5.02857445e-01
 -3.48543053e-02 -1.46036938e-01 -2.77058194e-01 -1.30239702e-02
 -7.24319159e-02  3.21603180e-01  2.15532280e-01  5.04350066e-01
 -4.54065419e-01 -3.06070464e-01  8.43657248e-01 -1.21586963e-01
  4.99983999e-01 -7.98493241e-02 -9.24569558e-02 -2.17110622e-01
  8.43107810e-01  6.01757512e-01  6.53102693e-04 -3.70276178e-01
 -4.21315011e-01 -1.73920899e-01 -4.67026261e-01 -4.96597780e-01
 -5.66749194e-01  1.51379457e+00 -3.18128658e-01 -8.31215119e-01
 -7.98503956e-01 -1.02824738e+00 -2.56562208e-01  1.07314558e+00
 -4.47148392e-01 -8.00054155e-01  5.83881166e-01  2.44921217e+00
  2.56843033e+00  1.14027509e+00  2.54632527e+00  1.35175952e+00]' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  X.loc[:, other_features] = other_scaler.fit_transform(X[other_features].astype(np.float64))
2025-04-24 20:27:41,331 - INFO - Job completed: model=xgboost, symbol=MSFT
2025-04-24 20:27:41,332 - INFO - Training Summary:
2025-04-24 20:27:41,332 - INFO -   Total jobs: 1
2025-04-24 20:27:41,332 - INFO -   Successful: 1
2025-04-24 20:27:41,332 - INFO -   Failed: 0
2025-04-24 20:27:41,332 - INFO -   Total duration: 18.05 seconds
